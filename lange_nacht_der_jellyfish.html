<html>
  <head>
    <title>The long night of the jellyfish!</title>
    <script type="text/javascript" src="lib/jquery-1.6.1.js"></script>
    <script type="text/javascript" src="lib/jquery-tmpl-beta1.js"></script>
    <!--  <script type="text/javascript" src="lib/lange-stub.js"></script> -->
    <script type="text/javascript" src="app/javascript/lange.js"></script>
    

    
    <script type="text/javascript" charset="utf-8">
     
    function extractSelectedEvents(){
        return $(".vevent").filter(".selected").map(function(index){
           return {
              id: index,
              summary: $(this).find(".summary").html(),
              dtstart: $(this).find(".dtstart").attr('title'),
              dateDescription: $(this).find(".dtstart").html()
           };
        }).toArray();
      };

      function renderPlan(){
        $('#plan').empty();
        $('#planTemplate').tmpl({eventSlots: Lange.schedule(extractSelectedEvents())})
            .appendTo( "#plan" );
        $('.conflict').click(function(){
           // find event with the id and click the checkbox
                var id = $(this).attr('eventId');
                $($('.vevent')[id]).find('.fancy-checkbox').click();
                $(this).remove(); 
        });
      }

     function addCheckBoxesToEvents() {
         $('.vevent').append("<input class='fancy-checkbox' type='checkbox'/>");
         $('.fancy-checkbox').change(function(x){
             $(this).parent().toggleClass("selected");
             renderPlan();
         });
     }
      $(document).ready(function(){
        
        addCheckBoxesToEvents(); 
       });
       
    </script>
    
    <script id="planTemplate" type="text/x-jquery-tmpl">
        Your plan:<br>
        <ul>
          {{each eventSlots}}
            {{if conflict}}&nbsp;
              <li>${vevents[0].dateDescription} - Damn! You have a conflict!!
                <ul>
                  {{each(index,value) vevents}}
                  <li class="conflict" eventId="${value.id}">${value.summary}</li>
                  {{/each}}
                </ul>
              </li>
            {{else}}
              <li>${vevent.dateDescription} - ${vevent.summary}</li>
            {{/if}}
          {{/each}}
        <ul/>
    </script>
    
    <style type="text/css" media="screen">
       div {padding: 10;}
    </style>
  </head>
  <body>
    Welcome to the long night of the jellyfish!  You can do anything on the long night of the jellyfish!
    
    <p>But here are some suggestions:
      
    
    <div class='vevent'>
         <span class="summary">See Jellyfish Play Guitar</span>
         - a performance by local jellyfish star "Bob Jellyfish"<abbr class="dtstart" title="2011-07-21T13:00">
           1pm, July 21</abbr> 
         at the Jellyfish Bar in <span class="location">Kaffee Mitte, 2 Weinmeisterstrasse, Berlin</span>.
        </span>
    </div>
    
    <div class='vevent'>
         <span class="summary">What do Jellyfish eat?</span>
         - a lecture on the jellyfishy ways of eating <abbr class="dtstart" title="2011-07-20T19:00">7pm, 20 July</abbr> 
         at the Jellyfish Bar in <span class="location">110 Sch√∂nhauser Alle, Berlin</span>.
         This event is at
         
        </span>
    </div>
    
    <div class='vevent'>
         <span class="summary">See Jellyfish Play Piano</span>
         - piano playing as you have never seen it before"<abbr class="dtstart" title="2011-07-21T13:00">1pm, July 21</abbr> 
         at the Jellyfish Bar in <span class="location">Kaffee Mitte, 2 Weinmeisterstrasse, Berlin</span>.
        </span>
    </div>

    <div id="plan">
    </div>
    <div id="movieList">
    </div>
    
  </body>
</html>  
